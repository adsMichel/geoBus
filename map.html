<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 8px;
        }
        #map iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
        }
    </style>
</head>
<body>
    <div id="map">
    </div>

    <!-- <script>
        navigator.geolocation.getCurrentPosition(position =>{
            const {latitude, longitude} = position.coords;
            console.log(latitude, longitude);
            
            // map.innerHTML = `<iframe width="600" height="450" src="https://maps.google.com/maps?q='+latitude+','+longitude+'&amp;z=15&amp;output=embed"></iframe>`;
            map.innerHTML = `<iframe src="https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
        });
    </script> -->

    <!-- const DESTINATION_LAT = -15.8046849; // Latitude do local alvo -->
    <!-- const DESTINATION_LON = -48.0802278;  // Longitude do local alvo -->

    <script>
    // ===============================================
    // 1. CONFIGURA√á√ïES
    // ===============================================
    
    // Coordenadas de Destino
    const DESTINATION_LAT = -15.8046849; // Latitude do local alvo
    const DESTINATION_LON = -48.0802278;  // Longitude do local alvo
    
    // Raio de proximidade em metros.
    const PROXIMITY_RADIUS_METERS = 100; 
    
    // Fator de convers√£o (aproximado) de graus para metros
    const METERS_PER_DEGREE = 111000;
    
    // Configura√ß√µes do GPS para for√ßar a atualiza√ß√£o a cada ~15 segundos
    const geoOptions = {
        enableHighAccuracy: true, // Tenta usar o GPS para maior precis√£o
        timeout: 5000,            // Tempo m√°ximo para obter a posi√ß√£o (5 segundos)
        // O cache de localiza√ß√£o n√£o deve ter mais de 15.000ms (15 segundos).
        // Isso for√ßa o navegador a buscar uma nova posi√ß√£o se a √∫ltima for mais antiga.
        maximumAge: 15000 
    };

    let alertTriggered = false; // Flag para garantir que o alerta s√≥ dispare uma vez


    // ===============================================
    // 2. FUN√á√ÉO DE C√ÅLCULO DE DIST√ÇNCIA (INALTERADA)
    // ===============================================

    function calculateApproximateDistance(lat1, lon1, lat2, lon2) {
        const dLat = lat2 - lat1;
        const dLon = lon2 - lon1;

        const dLatMeters = dLat * METERS_PER_DEGREE;
        const dLonMeters = dLon * METERS_PER_DEGREE * Math.cos(lat1 * Math.PI / 180);

        return Math.sqrt(dLatMeters * dLatMeters + dLonMeters * dLonMeters);
    }


    // ===============================================
    // 3. HANDLER DE SUCESSO (CHAMADO A CADA ATUALIZA√á√ÉO)
    // ===============================================

    function successHandler(position) {
        // Inclui 'accuracy' para fins de depura√ß√£o
        const { latitude, longitude, accuracy } = position.coords; 
        const timestamp = new Date(position.timestamp).toLocaleTimeString();
        
        console.log(`[${timestamp}] Posi√ß√£o Atual: Lat ${latitude.toFixed(6)}, Lon ${longitude.toFixed(6)} | Precis√£o: +/- ${accuracy.toFixed(0)}m`);
        
        // Calcule a dist√¢ncia
        const distanceInMeters = calculateApproximateDistance(
            latitude,
            longitude,
            DESTINATION_LAT,
            DESTINATION_LON
        );

        console.log(`Dist√¢ncia at√© o destino: ${distanceInMeters.toFixed(2)} metros`);

        // VERIFICA√á√ÉO: Dispara o alerta se estiver pr√≥ximo E se o alerta n√£o foi disparado
        if (distanceInMeters <= PROXIMITY_RADIUS_METERS) {
            
            if (!alertTriggered) {
                alert(`üéØ ALERTA DE PROXIMIDADE! Voc√™ est√° a APENAS ${distanceInMeters.toFixed(0)} metros do seu destino!`);
                alertTriggered = true; // Marca como disparado
            }
        } else {
            // Se saiu do raio de proximidade, permite que o alerta dispare novamente se voltar
            alertTriggered = false; 
        }

        // C√≥digo para atualizar o Iframe do mapa
        const mapElement = document.getElementById('map');
        if (mapElement) {
             // üéØ URL CORRIGIDA
             const correctMapUrl = `https://maps.google.com/maps?q=${latitude},${longitude}&z=15&output=embed`;
             
             
             mapElement.innerHTML = `<iframe 
                                 src="${correctMapUrl}" 
                                 height="500" 
                                 width="600" 
                                 style="border:0;" 
                                 loading="lazy" 
                                 allowfullscreen
                              ></iframe>`;
        }
    }


    // ===============================================
    // 4. HANDLER DE ERRO
    // ===============================================

    function errorHandler(error) {
        console.error("Erro ao monitorar a geolocaliza√ß√£o:", error.code, error.message);
        const mapElement = document.getElementById('map');
        if (mapElement) {
             let errorMessage = (error.code === 1) ? "Acesso √† localiza√ß√£o negado pelo usu√°rio." : "Erro ao obter a localiza√ß√£o.";
             mapElement.innerHTML = `<p style="color:red; text-align:center;">${errorMessage}</p>`;
        }
    }


    // ===============================================
    // 5. IN√çCIO DO MONITORAMENTO CONT√çNUO
    // ===============================================
    
    // watchPosition inicia o monitoramento e o watchID guarda a refer√™ncia (se quiser parar depois)
    const watchID = navigator.geolocation.watchPosition(
        successHandler, 
        errorHandler, 
        geoOptions // Usa as op√ß√µes que definem o intervalo de ~15s
    );
</script>

    
</body>
</html>