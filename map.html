<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 8px;
        }
        #map iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
        }
    </style>
</head>
<body>
    <div id="map">
    </div>

    <!-- <script>
        navigator.geolocation.getCurrentPosition(position =>{
            const {latitude, longitude} = position.coords;
            console.log(latitude, longitude);
            
            // map.innerHTML = `<iframe width="600" height="450" src="https://maps.google.com/maps?q='+latitude+','+longitude+'&amp;z=15&amp;output=embed"></iframe>`;
            map.innerHTML = `<iframe src="https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
        });
    </script> -->
    
    <script>
        // ===============================================
        // 1. CONFIGURA√á√ïES
        // ===============================================

        // Coordenadas de Destino (Exemplo: Torre Eiffel em Paris)
        const DESTINATION_LAT = -15.8046849; // Latitude do local alvo
        const DESTINATION_LON = -48.0802278;  // Longitude do local alvo
        
        // Raio de Proximidade (em metros)
        const PROXIMITY_RADIUS_METERS = 200; 

        // Fator de convers√£o (aproximado) de graus para metros
        const METERS_PER_DEGREE = 111000;
        
        // Configura√ß√µes do GPS (para atualizar a cada ~10 segundos)
        const geoOptions = {
            enableHighAccuracy: true, // Tenta usar o GPS para maior precis√£o
            timeout: 5000,            // Tempo m√°ximo para obter a posi√ß√£o (5 segundos)
            // O cache de localiza√ß√£o n√£o deve ter mais de 10.000ms (10 segundos)
            // Isso for√ßa o navegador a buscar uma nova posi√ß√£o se a √∫ltima tiver mais de 10s.
            maximumAge: 10000 
        };

        let alertTriggered = false; // Flag para garantir que o alerta s√≥ dispare uma vez (opcional)


        // ===============================================
        // 2. FUN√á√ÉO DE C√ÅLCULO DE DIST√ÇNCIA
        // ===============================================

        function calculateApproximateDistance(lat1, lon1, lat2, lon2) {
            const dLat = lat2 - lat1;
            const dLon = lon2 - lon1;

            const dLatMeters = dLat * METERS_PER_DEGREE;
            // Corre√ß√£o de longitude com base na latitude (cos(lat em radianos))
            const dLonMeters = dLon * METERS_PER_DEGREE * Math.cos(lat1 * Math.PI / 180);

            // Teorema de Pit√°goras
            return Math.sqrt(dLatMeters * dLatMeters + dLonMeters * dLonMeters);
        }


        // ===============================================
        // 3. FUN√á√ÉO DE MONITORAMENTO (CHAMADA A CADA ATUALIZA√á√ÉO)
        // ===============================================

        function successHandler(position) {
            const { latitude, longitude } = position.coords;
            const timestamp = new Date(position.timestamp).toLocaleTimeString();
            
            console.log(`[${timestamp}] Posi√ß√£o Atual: Lat ${latitude.toFixed(4)}, Lon ${longitude.toFixed(4)}`);
            
            // Calcule a dist√¢ncia
            const distanceInMeters = calculateApproximateDistance(
                latitude,
                longitude,
                DESTINATION_LAT,
                DESTINATION_LON
            );

            console.log(`Dist√¢ncia at√© o destino: ${distanceInMeters.toFixed(2)} metros`);

            // Verifique se est√° pr√≥ximo E se o alerta ainda n√£o foi disparado
            if (distanceInMeters <= PROXIMITY_RADIUS_METERS) {
                
                // S√≥ dispara o alerta se n√£o tiver sido disparado antes (opcional)
                if (!alertTriggered) {
                    alert(`üéØ ALERTA! Voc√™ est√° a APENAS ${distanceInMeters.toFixed(0)} metros de seu destino!`);
                    alertTriggered = true; // Marca como disparado
                    
                    // Opcional: Para de monitorar ap√≥s disparar o alerta
                    // navigator.geolocation.clearWatch(watchID); 
                }
            } else {
                // Se estava perto e se afastou, podemos redefinir a flag (para um novo alerta se voltar)
                alertTriggered = false; 
            }

            // Atualiza o mapa no HTML
            const mapElement = document.getElementById('map');
            if (mapElement) {
                // Link do Google Maps para sua posi√ß√£o atual (Latitude, Longitude)
                mapElement.innerHTML = `<iframe src="https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
            }
        }

        function errorHandler(error) {
            // Trata erros (ex: usu√°rio nega permiss√£o, GPS indispon√≠vel)
            console.error("Erro ao monitorar a geolocaliza√ß√£o:", error.code, error.message);
            let errorMessage = "Erro ao obter a localiza√ß√£o. Verifique as permiss√µes do navegador.";
            if (error.code === 1) {
                errorMessage = "Acesso √† localiza√ß√£o negado pelo usu√°rio.";
            }
            document.getElementById('map').innerHTML = `<p style="color:red;">${errorMessage}</p>`;
        }


        // ===============================================
        // 4. IN√çCIO DO MONITORAMENTO
        // ===============================================
        
        // watchID √© o identificador da sess√£o de monitoramento
        const watchID = navigator.geolocation.watchPosition(
            successHandler, 
            errorHandler, 
            geoOptions // As op√ß√µes que definem o intervalo (~10s)
        );
    </script>

    
</body>
</html>