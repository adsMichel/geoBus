<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 8px;
        }
        #map iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
        }
    </style>
</head>
<body>
    <!-- <div id="map">
    </div> -->

    <iframe id="mapFrame" 
        height="500" 
        width="600" 
        style="border:0;" 
        loading="lazy" 
        allowfullscreen>
    </iframe>
    <div id="status">Iniciando monitoramento de localiza√ß√£o...</div>

    <!-- <script>
        navigator.geolocation.getCurrentPosition(position =>{
            const {latitude, longitude} = position.coords;
            console.log(latitude, longitude);
            
            // map.innerHTML = `<iframe width="600" height="450" src="https://maps.google.com/maps?q='+latitude+','+longitude+'&amp;z=15&amp;output=embed"></iframe>`;
            map.innerHTML = `<iframe src="https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
        });
    </script> -->

    <!-- const DESTINATION_LAT = -15.8046849; // Latitude do local alvo -->
    <!-- const DESTINATION_LON = -48.0802278;  // Longitude do local alvo -->

<script>
    // ===============================================
    // 1. CONFIGURA√á√ïES
    // ===============================================
    
    // Coordenadas de Destino
    const DESTINATION_LAT = -15.8046849; 
    const DESTINATION_LON = -48.0802278;  
    
    // Raio de proximidade em metros.
    const PROXIMITY_RADIUS_METERS = 100; 
    
    // Fator de convers√£o (aproximado) de graus para metros
    const METERS_PER_DEGREE = 111000;
    
    // Configura√ß√µes do GPS para for√ßar a atualiza√ß√£o a cada ~15 segundos (15000ms)
    const geoOptions = {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 15000 
    };

    let alertTriggered = false; 
    // Obtenha a refer√™ncia do iframe e do elemento de status ANTES de iniciar o monitoramento
    const mapFrame = document.getElementById('mapFrame');
    const statusElement = document.getElementById('status');


    // ===============================================
    // 2. FUN√á√ÉO DE C√ÅLCULO DE DIST√ÇNCIA (INALTERADA)
    // ===============================================

    function calculateApproximateDistance(lat1, lon1, lat2, lon2) {
        const dLat = lat2 - lat1;
        const dLon = lon2 - lon1;

        const dLatMeters = dLat * METERS_PER_DEGREE;
        const dLonMeters = dLon * METERS_PER_DEGREE * Math.cos(lat1 * Math.PI / 180);

        return Math.sqrt(dLatMeters * dLatMeters + dLonMeters * dLonMeters);
    }


    // ===============================================
    // 3. HANDLER DE SUCESSO (CHAMADO A CADA 15 SEGUNDOS)
    // ===============================================

    function successHandler(position) {
        const { latitude, longitude, accuracy } = position.coords; 
        const distanceInMeters = calculateApproximateDistance(
            latitude,
            longitude,
            DESTINATION_LAT,
            DESTINATION_LON
        );
        
        // Atualiza a mensagem de status
        if (statusElement) {
            statusElement.innerHTML = `Posi√ß√£o: Lat ${latitude.toFixed(6)}, Lon ${longitude.toFixed(6)} | Dist√¢ncia: ${distanceInMeters.toFixed(0)}m`;
        }

        // VERIFICA√á√ÉO DE PROXIMIDADE
        if (distanceInMeters <= PROXIMITY_RADIUS_METERS) {
            if (!alertTriggered) {
                alert(`üéØ ALERTA! Voc√™ est√° a APENAS ${distanceInMeters.toFixed(0)} metros do seu destino!`);
                alertTriggered = true;
            }
        } else {
            alertTriggered = false; 
        }

        // üéØ C√ìDIGO CORRIGIDO PARA O IFRAME: Apenas muda o atributo 'src'
        if (mapFrame) {
             // 1. Constr√≥i a URL corretamente (usando ${} para as vari√°veis)
             const correctMapUrl = `https://maps.google.com/maps?q=${latitude},${longitude}&z=15&output=embed`;
             
             // 2. Muda apenas o 'src' do iframe, sem recarregar o elemento inteiro!
             mapFrame.src = correctMapUrl;
        }
    }


    // ===============================================
    // 4. HANDLER DE ERRO (INALTERADO)
    // ===============================================

    function errorHandler(error) {
        console.error("Erro ao monitorar a geolocaliza√ß√£o:", error.code, error.message);
        if (statusElement) {
             let errorMessage = (error.code === 1) ? "Acesso √† localiza√ß√£o negado pelo usu√°rio. Permita o uso do GPS." : "Erro ao obter a localiza√ß√£o.";
             statusElement.innerHTML = `<p style="color:red; text-align:center;">${errorMessage}</p>`;
        }
        // Al√©m disso, desabilita o iframe se houver erro
        if (mapFrame) {
            mapFrame.src = "";
        }
    }


    // ===============================================
    // 5. IN√çCIO DO MONITORAMENTO CONT√çNUO
    // ===============================================
    
    // Inicia o monitoramento a cada 15 segundos
    const watchID = navigator.geolocation.watchPosition(
        successHandler, 
        errorHandler, 
        geoOptions
    );
</script>

    
</body>
</html>