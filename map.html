<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 8px;
        }
        #map iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
        }
    </style>
</head>
<body>
    <div id="map">
    </div>

    <!-- <script>
        navigator.geolocation.getCurrentPosition(position =>{
            const {latitude, longitude} = position.coords;
            console.log(latitude, longitude);
            
            // map.innerHTML = `<iframe width="600" height="450" src="https://maps.google.com/maps?q='+latitude+','+longitude+'&amp;z=15&amp;output=embed"></iframe>`;
            map.innerHTML = `<iframe src="https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
        });
    </script> -->

    <script>
    // ===============================================
    // 1. CONFIGURA√á√ïES
    // ===============================================
    const DESTINATION_LAT = -15.8051211; // Latitude do local alvo
    const DESTINATION_LON = -48.0799188;  // Longitude do local alvo
    const PROXIMITY_RADIUS_METERS = 200; // Raio de proximidade (em metros)

    // Fator de convers√£o (aproximado) de graus para metros
    const METERS_PER_DEGREE = 111000;
    
    // Configura√ß√µes do GPS para for√ßar a atualiza√ß√£o a cada ~10 segundos
    const geoOptions = {
        enableHighAccuracy: true, // Tenta usar o GPS para maior precis√£o
        timeout: 15000,            // Tempo m√°ximo para obter a posi√ß√£o (5 segundos)
        // O cache de localiza√ß√£o n√£o deve ter mais de 10.000ms (10 segundos).
        // Isso for√ßa o navegador a buscar uma nova posi√ß√£o se a √∫ltima for mais antiga.
        maximumAge: 20000 
    };

    let alertTriggered = false; // Flag para garantir que o alerta s√≥ dispare uma vez


    // ===============================================
    // 2. FUN√á√ÉO DE C√ÅLCULO DE DIST√ÇNCIA (INALTERADA)
    // ===============================================
    function calculateApproximateDistance(lat1, lon1, lat2, lon2) {
        const dLat = lat2 - lat1;
        const dLon = lon2 - lon1;

        const dLatMeters = dLat * METERS_PER_DEGREE;
        const dLonMeters = dLon * METERS_PER_DEGREE * Math.cos(lat1 * Math.PI / 180);

        return Math.sqrt(dLatMeters * dLatMeters + dLonMeters * dLonMeters);
    }


    // ===============================================
    // 3. HANDLER DE SUCESSO (CHAMADO A CADA ATUALIZA√á√ÉO)
    // ===============================================
    function successHandler(position) {
        const { latitude, longitude } = position.coords;
        const timestamp = new Date(position.timestamp).toLocaleTimeString();
        
        console.log(`[${timestamp}] Posi√ß√£o Atual: Lat ${latitude.toFixed(6)}, Lon ${longitude.toFixed(6)}`);
        
        // Calcule a dist√¢ncia
        const distanceInMeters = calculateApproximateDistance(
            latitude,
            longitude,
            DESTINATION_LAT,
            DESTINATION_LON
        );

        console.log(`Dist√¢ncia at√© o destino: ${distanceInMeters.toFixed(2)} metros`);

        // Verifique a proximidade
        if (distanceInMeters <= PROXIMITY_RADIUS_METERS) {
            
            // Dispara o alerta APENAS se n√£o tiver sido disparado antes
            if (!alertTriggered) {
                alert(`üéØ ALERTA! Voc√™ est√° a APENAS ${distanceInMeters.toFixed(0)} metros do seu destino!`);
                alertTriggered = true; // Marca como disparado
                
                // Opcional: Para de monitorar para economizar bateria/recursos:
                // navigator.geolocation.clearWatch(watchID); 
            }
        } else {
            // Se afastou, redefinimos a flag para permitir um novo alerta no futuro
            alertTriggered = false; 
        }

        // Atualiza o mapa no HTML
        const mapElement = document.getElementById('map');
        if (mapElement) {
             // Mantenho seu formato de URL para o mapa, mas a URL padr√£o do Google Maps √© mais confi√°vel.
             mapElement.innerHTML = `<iframe src="https://maps.google.com/maps?q=$${latitude},${longitude}&z=12&output=embed" height="500" width="600"></iframe>`;
        }
    }

    // ===============================================
    // 4. HANDLER DE ERRO
    // ===============================================
    function errorHandler(error) {
        // Trata erros (ex: usu√°rio nega permiss√£o)
        console.error("Erro ao monitorar a geolocaliza√ß√£o:", error.code, error.message);
        const mapElement = document.getElementById('map');
        if (mapElement) {
             let errorMessage = (error.code === 1) ? "Acesso √† localiza√ß√£o negado pelo usu√°rio." : "Erro ao obter a localiza√ß√£o.";
             mapElement.innerHTML = `<p style="color:red;">${errorMessage}</p>`;
        }
    }


    // ===============================================
    // 5. IN√çCIO DO MONITORAMENTO CONT√çNUO
    // ===============================================
    
    // watchPosition inicia o monitoramento e o watchID guarda a refer√™ncia
    const watchID = navigator.geolocation.watchPosition(
        successHandler, 
        errorHandler, 
        geoOptions // Usa as op√ß√µes que definem o intervalo de ~10s
    );
</script>

    
</body>
</html>